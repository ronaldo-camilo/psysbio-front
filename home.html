<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Sistema de Tarefas</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header class="page-header">
            <div class="user-info" id="userInfo">Usu√°rio</div>
            <a href="#" class="logout-button" id="logoutButton">Sair</a>
        </header>

        <main>
            <div class="content-boxes" id="groupsContainer">
                <a href="mytasks.html" class="content-box">
                    Minhas Tarefas
                </a>
                <a href="group_create.html" class="content-box create-new" id="createGroupLinkPlaceholder">
                    + Criar novo grupo
                </a>
            </div>
             <div class="content-boxes" style="margin-top: 30px; border-top: 1px solid #ccc; padding-top:20px;">
                <a href="mytasks.html#todo" class="content-box" style="background-color: #fce4ec;">To do</a>
                <a href="mytasks.html#inprogress" class="content-box" style="background-color: #fff9c4;">In Progress</a>
                <a href="mytasks.html#done" class="content-box" style="background-color: #e8f5e9;">Done</a>
                <a href="#" class="content-box" style="background-color: #d4bef1;">Deadlines</a>
            </div>
        </main>
    </div>

    <script src="js/api.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            let currentUser;
            try {
                currentUser = await api.getCurrentUser();
                if (!currentUser || !currentUser.isLoggedIn) {
                    window.location.href = 'login.html';
                    return;
                }
            } catch (e) {
                console.error("Error getting current user, redirecting to login.", e);
                window.location.href = 'login.html';
                return;
            }

            document.getElementById('userInfo').textContent = currentUser.name || currentUser.username;

            document.getElementById('logoutButton').addEventListener('click', async (e) => {
                e.preventDefault();
                try {
                    await api.logout();
                    window.location.href = 'login.html';
                } catch (error) {
                    console.error("Logout failed:", error);
                }
            });

            const groupsContainer = document.getElementById('groupsContainer');
            const createGroupLinkPlaceholder = document.getElementById('createGroupLinkPlaceholder');

            try {
                const groups = await api.getGroups();
                groups.forEach(group => {
                    const groupLink = document.createElement('a');
                    groupLink.href = `folder_list.html?group=${encodeURIComponent(group.name)}`;
                    groupLink.classList.add('content-box');
                    groupLink.textContent = group.name;
                    groupsContainer.insertBefore(groupLink, createGroupLinkPlaceholder);
                });
            } catch (error) {
                console.error("Error fetching groups:", error);
            }
        });
    </script>
</body>
</html>