<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Pastas</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header class="page-header">
            <div class="user-info" id="groupNameDisplay">Grupo</div>
            <a href="#" class="logout-button" id="logoutButton">Sair</a>
        </header>

        <main>
            <div class="content-boxes" id="foldersContainer">
                <a href="#" id="createNewFolderLink" class="content-box create-new">
                    + Criar nova pasta
                </a>
            </div>
        </main>

        <footer class="footer-nav">
            <a href="home.html" class="return-button">&lt; Voltar para Home</a>
        </footer>
    </div>
    <script src="js/api.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            let currentUser;
            try {
                currentUser = await api.getCurrentUser();
                if (!currentUser || !currentUser.isLoggedIn) {
                    window.location.href = 'login.html';
                    return;
                }
            } catch (e) {
                console.error("Error getting current user, redirecting to login.", e);
                window.location.href = 'login.html';
                return;
            }

            document.getElementById('logoutButton').addEventListener('click', async (e) => {
                e.preventDefault();
                await api.logout();
                window.location.href = 'login.html';
            });

            const urlParams = new URLSearchParams(window.location.search);
            const groupNameParam = urlParams.get('group');

            if (!groupNameParam) {
                alert("Nome do grupo nÃ£o especificado.");
                window.location.href = 'home.html';
                return;
            }

            const groupName = decodeURIComponent(groupNameParam);
            document.title = `Lista de Pastas - ${groupName}`;
            document.getElementById('groupNameDisplay').textContent = groupName;

            const createNewFolderLink = document.getElementById('createNewFolderLink');
            createNewFolderLink.href = `folder_create.html?group=${encodeURIComponent(groupName)}`;

            const foldersContainer = document.getElementById('foldersContainer');
            try {
                const folders = await api.getFolders(groupName);
                folders.forEach(folder => {
                    const folderLink = document.createElement('a');
                    folderLink.href = `folder_tasks.html?group=${encodeURIComponent(groupName)}&folder=${encodeURIComponent(folder.name)}`;
                    folderLink.classList.add('content-box');
                    folderLink.textContent = folder.name;
                    foldersContainer.insertBefore(folderLink, createNewFolderLink);
                });
            } catch (error) {
                console.error(`Error fetching folders for group ${groupName}:`, error);
            }
        });
    </script>
</body>
</html>